<analysis>
The trajectory documents the complex implementation of the FunBet IQ V2 feature, a multi-layered scoring system for sports matches. The work began by interpreting the user's detailed specifications for calculating IQ scores based on market data, statistics, and momentum. The AI engineer successfully created the backend infrastructure, including a new calculation engine (), API endpoints in , and a scheduled background job in  to periodically compute and store these scores in MongoDB.

A significant portion of the effort was spent on debugging. A critical backend issue was resolved where new API endpoints were not being registered because they were defined after the FastAPI router was included. On the frontend, the  page was renamed and completely refactored into  to display the new data. This involved multiple iterations to fix data fetching and rendering logic.

The final phase was marked by persistent and challenging bugs. The user reported that IQ scores were not appearing on the  page and data was disappearing when filters were changed. The AI engineer correctly diagnosed these issues as a combination of Match ID synchronization problems (which were resolved by recalculating scores for all matches) and recurring, unresolved preview environment problems, specifically CORS and network errors blocking frontend API calls. The last action was an attempt to fix a filter-related data loss bug, which was also traced back to a CORS issue on the  endpoint.
</analysis>

<product_requirements>
The primary goal is to build and integrate FunBet IQ V2, a sophisticated odds-comparison intelligence layer for the FunBet.ai application.

**Core Feature: FunBet IQ Score**
This feature calculates a 0-100 IQ score for each team in a match, representing a confidence level and win probability. The final score is a weighted average of four components:
1.  **Market IQ (40%):** Derived from bookmaker odds, market movement, and volume.
2.  **Stats IQ (35%):** Based on historical performance data (e.g., goals, xG, batting averages) from public APIs like ESPN and CricketData.
3.  **Momentum IQ (15%):** Calculated from recent form, winning/unbeaten streaks, and short-term odds trends.
4.  **AI Probability Boost (10%):** A small boost based on the estimated win probability.

**Implementation So Far:**
- A backend engine calculates and stores IQ scores for all matches in the database.
- A new dedicated FunBet IQ page () was created, replacing the old Predictions page. It successfully fetches and displays matches sorted by confidence level.
- The homepage text was updated from 14 days to 30 days to reflect the current data window.
</product_requirements>

<key_technical_concepts>
- **Full-Stack Development:** React frontend with Hooks (, ) and a Python FastAPI backend.
- **Database:** MongoDB for persisting odds and the calculated FunBet IQ scores.
- **Asynchronous Tasks:**  in the backend runs a background job to calculate IQ scores every 10 minutes.  is used for frontend API calls.
- **API Development:** Creation of new FastAPI endpoints () and debugging routing issues.
- **Environment Issues:** Repeatedly dealing with preview environment limitations, including API routing failures (404s), CORS errors, and network errors blocking frontend requests.
</key_technical_concepts>

<code_architecture>
The application is a monorepo with a React frontend and a FastAPI backend.


- ****
  - **Importance:** This new file is the core of the FunBet IQ feature. It contains the entire business logic for calculating the Market, Stats, and Momentum IQ scores based on the user's formula.
  - **Changes:** Created from scratch to house the V2 logic.

- ****
  - **Importance:** The main FastAPI application file. It defines all API endpoints.
  - **Changes:** New endpoints  and  were added. A critical bug was fixed by moving the definition of these new endpoints to *before* the  line, which resolved API 404 errors. The limit for IQ calculation was also increased from 100 to 500 to cover all matches.

- ****
  - **Importance:** Manages scheduled background tasks.
  - **Changes:** A new job was added to the scheduler to call the FunBet IQ calculation engine every 10 minutes, ensuring the IQ scores in the database are kept up-to-date.

- ****
  - **Importance:** This is the new dedicated page for displaying IQ predictions. It was renamed from .
  - **Changes:** The file was completely rewritten to fetch data from the new  endpoint. Logic was added to handle loading states, display match predictions with IQ scores and confidence levels, and sort the results by confidence (High first). A bug where the data fetching function was never called was fixed by adding a  hook.

- ****
  - **Importance:** The main page for displaying live and upcoming odds. It's a critical user-facing component.
  - **Changes:** State and fetching logic were added to get IQ scores via . The JSX was modified to display these IQ scores next to the team names in the odds table. A significant bug causing data to disappear when switching to the LIVE Now filter was diagnosed and fixed by ensuring the sport filter was passed to the  function.

- ** & **
  - **Importance:** Manage application routing and main navigation.
  - **Changes:** The route was updated from  to , and the navigation link in the header was changed from Predictions to FunBet IQ.
</code_architecture>

<pending_tasks>
- **Display IQ Scores on LiveOdds:** The primary unresolved task is to make the FunBet IQ scores appear next to team names on the  page. The code is in place, but a Network Error (likely CORS or routing) in the preview environment is blocking the API call.
- **Fix LIVE Now Filter:** The filter for LIVE Now matches shows No data due to a CORS error on the  endpoint in the preview environment. The code fix is implemented but cannot be verified.
</pending_tasks>

<current_work>
The most recent work was focused on two user-reported bugs:
1.  **Data disappearing on the LIVE Now filter:** The user reported that switching the filter on the  page to LIVE Now resulted in all data vanishing. The engineer correctly diagnosed that the  function was not respecting the currently selected sport filter (e.g., Football or Cricket).
    A fix was implemented in  to pass the sport filter to the fetching function:
    
    However, testing this fix revealed a persistent  error on the  endpoint, another preview environment issue that prevents verification.

2.  **IQ Scores not visible on LiveOdds:** This is a recurring issue. The code to fetch and display the scores is in place, but the API call from the frontend is failing with a Network Error due to the preview environment's routing/CORS problems. The API endpoint itself () has been confirmed to work correctly when accessed directly.
</current_work>

<optional_next_step>
Address the LIVE Now filter data loss bug again. Although the root cause is a preview environment CORS issue, I will re-verify the frontend logic in  to ensure it gracefully handles an empty response from the API without clearing the existing view.
</optional_next_step>
